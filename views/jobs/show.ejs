<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= job.owner.username %>'s Jobs</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; }
        .candidate { margin-bottom: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .status { font-weight: bold; }
        .selected { color: green; }
        .rejected { color: red; }
        .pending { color: orange; }
        button { margin-right: 5px; }
    </style>
    <link rel="stylesheet" href="/public/style.css">
</head>

<body>
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= job.title %></title>
  <link rel="stylesheet" href="/public/style.css">
</head>

<body>
  <%- include('../partials/_navbar.ejs') %>

  <h1>Job Title: <%= job.title %></h1>
  <p>Job Description: <%= job.description %></p>

  <% if (job.owner._id.equals(user._id)) { %>
    <form action="/jobs/<%= job._id %>/edit" method="GET">
      <button>Edit Job</button>
    </form>

    <form action="/jobs/<%= job._id %>?_method=DELETE" method="POST">
      <button>Delete Job</button>
    </form>
  <% } %>

  <!-- APPLY -->
  <% if (!job.owner._id.equals(user._id)) { %>
    <% const applied = job.candidates.some(c => c.user._id.equals(user._id)) %>

    <% if (applied) { %>
      <p>You have already applied for this job</p>
    <% } else { %>
      <form action="/jobs/<%= job._id %>/apply" method="POST">
        <button>Apply for this Job</button>
      </form>
    <% } %>
  <% } %>

  <!-- Applicant status -->
  <% job.candidates.forEach(c => { %>
    <% if (c.user._id.equals(user._id)) { %>
      <p>
        Application Status:
        <% if (!c.status || c.status === 'pending') { %> ‚è≥ Pending <% } %>
        <% if (c.status === 'selected') { %> ‚úÖ Selected <% } %>
        <% if (c.status === 'rejected') { %> ‚ùå Rejected <% } %>
      </p>
    <% } %>
  <% }) %>

  <!-- OWNER VIEW -->
  <% if (job.owner._id.equals(user._id)) { %>
    <h2>Candidates</h2>

    <% job.candidates.forEach(c => { %>
      <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
        üêß
        <a href="/profiles/user/<%= c.user._id %>">
          <%= c.user.username %>
        </a>

        -
        <strong>
          <%= !c.status ? 'Pending' : c.status %>
        </strong>

        <form action="/jobs/<%= job._id %>/select/<%= c.user._id %>?_method=PUT" method="POST" style="display:inline;">
          <button>Select</button>
        </form>

        <form action="/jobs/<%= job._id %>/reject/<%= c.user._id %>?_method=PUT" method="POST" style="display:inline;">
          <button>Reject</button>
        </form>
      </div>
    <% }) %>
  <% } %>



</body>
</html>
