<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= job.owner.username %>'s Jobs</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; }
        .candidate { margin-bottom: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .status { font-weight: bold; }
        .selected { color: green; }
        .rejected { color: red; }
        .pending { color: orange; }
        button { margin-right: 5px; }
    </style>
</head>

<body>
    <%- include('../partials/_navbar.ejs') %>

    <h1>Job Title: <%= job.title %></h1>
    <p>Job Description: <%= job.description %></p>

    <% if (job.owner._id.equals(user._id)) { %>
        <form action="/jobs/<%= job._id %>/edit" method="GET">
            <button type="submit">Edit Job</button>
        </form>
        <form action="/jobs/<%= job._id %>?_method=DELETE" method="POST">
            <button>Delete Job</button>
        </form>
    <% } %>

    <!-- For non-owner users -->
    <% if (!job.owner._id.equals(user._id)) { %>
        <% const applied = job.candidates.some(c => c.user._id.equals(user._id)) %>
        <% if (applied) { %>
            <p>You have already applied for this job</p>
        <% } else { %>
            <form action="/jobs/<%= job._id %>/apply" method="POST">
                <button>Apply for this Job</button>
            </form>
        <% } %>
    <% } %>

    <!-- Display current user's application status -->
    <% job.candidates.forEach(c => { %>
        <% if (c.user._id.equals(user._id)) { %>
            <p>
                Application Status:
                <% if (!c.status || c.status === 'pending') { %> 
                    <span class="status pending">‚è≥ Pending</span> 
                <% } %>
                <% if (c.status === 'selected') { %> 
                    <span class="status selected">‚úÖ Selected</span> 
                <% } %>
                <% if (c.status === 'rejected') { %> 
                    <span class="status rejected">‚ùå Rejected</span> 
                <% } %>
            </p>
        <% } %>
    <% }) %>

    <!-- Owner view of candidates -->
    <% if (job.owner._id.equals(user._id)) { %>
        <h2>Candidates</h2>
        <% job.candidates.forEach(c => { %>
            <div class="candidate">
                üêß <%= c.user.username %> ‚Äî
                <strong class="status 
                    <%= !c.status || c.status === 'pending' ? 'pending' : '' %>
                    <%= c.status === 'selected' ? 'selected' : '' %>
                    <%= c.status === 'rejected' ? 'rejected' : '' %>">
                    <%= !c.status ? 'Pending' : c.status.charAt(0).toUpperCase() + c.status.slice(1) %>
                </strong>
                <form action="/jobs/<%= job._id %>/select/<%= c.user._id %>?_method=PUT" method="POST" style="display:inline;">
                    <button>Select</button>
                </form>
                <form action="/jobs/<%= job._id %>/reject/<%= c.user._id %>?_method=PUT" method="POST" style="display:inline;">
                    <button>Reject</button>
                </form>
            </div>
        <% }) %>
    <% } %>

</body>
</html>
